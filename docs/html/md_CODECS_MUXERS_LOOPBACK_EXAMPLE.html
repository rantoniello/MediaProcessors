<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>MediaProcessors: CODECS_MUXERS_LOOPBACK_EXAMPLE</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MediaProcessors
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">CODECS_MUXERS_LOOPBACK_EXAMPLE </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Application code analysis </h1>
<p>The example source code: <a class="el" href="codecs__muxers__loopback_8c.html" title="Complete encoding-&gt;multiplexing-&gt;demultiplexing-&gt;decoding-&gt;rendering loopback example. ">codecs_muxers_loopback.c</a></p>
<p>This example implements a full video coding and muxing loopback path:</p><ul>
<li>Server side:<ul>
<li>generates a video raw source;</li>
<li>encodes the video source (in one of the following: H.264, MPEG2-video or MLHE);</li>
<li>multiplex the video encoded elementary stream in RTSP session;</li>
</ul>
</li>
<li>Client side:<ul>
<li>de-multiplex video elementary stream;</li>
<li>decodes the video;</li>
<li>renders the video in a frame buffer.</li>
</ul>
</li>
</ul>
<p>The application flow in this example is analogue to the one shown in <a href="md_DOCUMENTATION.html#How_to_use_a_Processor_the_API">figure 2</a>, but with the following modified thread scheme:</p><ul>
<li>Server side:<ul>
<li>A 'producer thread' generates raw video and sends raw YUV frames to the video encoder;</li>
<li>A 'multiplexer thread' receives encoded frames from video encoder and sends to the multiplexer (that is, to the remote client using the RTSP session);</li>
<li>The main thread is used to execute the HTTP server listening loop (until an application interruption signal -"ctrl+c"- is recieved)</li>
</ul>
</li>
<li>Client side:<ul>
<li>A 'de-multiplexer thread' receives the encoded frames from the RTSP connection, and sends to the video decoder;</li>
<li>A 'consumer thread' finally reads the raw video frame from the decoder and renders (using the 3rd party library SDL2).</li>
</ul>
</li>
</ul>
<h3>Initializing application</h3>
<p>Initialization consists in the same steps as the ones enumerated in the "typical application prologue" (see <a href="md_DOCUMENTATION.html#How_to_use_a_Processor_the_API">the API documentation</a>):</p>
<ol type="1">
<li>Initialize (open) the processors (PROCS) module (this is done by calling function '<a class="el" href="procs_8c.html#af5f91a46882b5706b25327384ba347d8">procs_module_open()</a>');</li>
<li>Register the processor types we support in the application (performed using the operation 'PROCS_REGISTER_TYPE' provided through the function '<a class="el" href="procs_8c.html#a226ac6dfd7598a59b9ceab3a92239a80">procs_module_opt()</a>');</li>
<li>Create (open) an instance of the PROCS module (using the function '<a class="el" href="procs_8c.html#a6fae33560b633113d848f6ec5e8461e5">procs_open()</a>' which returns an instance handler);</li>
<li>Creates specific processors instances (using the operation 'PROCS_POST' with the function '<a class="el" href="procs_8c.html#a7af2e6f2788006cfc96ca8d811922ffa">procs_opt()</a>'; a unique processor identifier is supplied for each instance):<ul>
<li>Create a video encoder instance</li>
<li>Create a video decoder instance</li>
<li>Create a RTSP multiplexor instance</li>
<li>Create a RTSP de-multiplexor instance</li>
</ul>
</li>
</ol>
<p>Nevertheless, there are some new considerations when initializing and handling the multiplexer and demultiplexer processors. We have an insight on this in the next subsections.</p>
<h4>Initializing and handling the multiplexer</h4>
<p>After instantiating the multiplexer, we must register all the elementary streams we will be serving (in this example only a video stream is served, but we may add other video or audio streams).<br />
 This is done using the following API call: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;ret_code= procs_opt(procs_ctx, &quot;PROCS_ID_ES_MUX_REGISTER&quot;, mux_proc_id, mime_setting, &amp;rest_str);</div></div><!-- fragment --><p> If succeed, the <b>elementary stream identifier</b> will be returned in a JSON of the form: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{&quot;elementary_stream_id&quot;:number}</div></div><!-- fragment --><p> Knowing the elementary stream Id. is essential for multiplexing; is a unique number used to discriminate to which of the multiplexed streams an input frame is to be sent.<br />
</p>
<p>This is implemented in the code of the multiplexer thread (function '<a class="el" href="codecs__muxers__loopback_8c.html#a494104de8b24b4783b3e8de4609c761e">mux_thr()</a>'). The important detail to remark is that <b>the elementary stream Id. must be specified in the input frame using the <a class="el" href="structproc__frame__ctx__s.html#a457dcb8ae6440506054f07483f48be1f">proc_frame_ctx_s::es_id</a> field</b>. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;proc_frame_ctx-&gt;es_id= thr_ctx-&gt;elem_strem_id_video_server;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;ret_code= procs_send_frame(thr_ctx-&gt;procs_ctx, thr_ctx-&gt;mux_proc_id, proc_frame_ctx);</div></div><!-- fragment --><p> If more than one source is used (e.g. video and audio), you must use the corresponding elementary stream Id. for sending the frames of each source.</p>
<h4>Initializing and handling the de-multiplexer</h4>
<p>Regarding to the de-multiplexer initialization, the RTSP client must be provided with the listening URL in the instantiation (e.g. "rtsp_url=rtsp://127.0.0.1:8574/session").</p>
<p>When handling the de-mutiplexer, client application does not know at first instance how many sources are carried in a session. Thus, once the session is established and the multimedia streaming started -that is, when receiving the first frame-, the de-multiplexer API should be used to know the elementary streams carried and the identifiers assigned to each one. It is important to remark that the elementary streams identifiers used at the multiplexer are decoupled of the ones used at the de-multiplexer (in fact, in the case of the RTSP implementation, the de-multiplexer uses the service port as the Id., and the multiplexer use an incrementing counter).<br />
 We ask then for the state of the demutiplexer when receiving the first frame (see de-multiplexer thread function '<a class="el" href="codecs__muxers__loopback_8c.html#ae66adca53cb5b2afde52cb2381a2384a">dmux_thr()</a>'): </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;ret_code= procs_opt(thr_ctx-&gt;procs_ctx, &quot;PROCS_ID_GET&quot;, thr_ctx-&gt;dmux_proc_id, &amp;rest_str);</div></div><!-- fragment --><p> The answer will be of the form: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;   &quot;settings&quot;:{</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;      &quot;rtsp_url&quot;:&quot;rtsp://127.0.0.1:8574/session&quot;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;   },</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;   &quot;elementary_streams&quot;:[</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;      {</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;         &quot;sdp_mimetype&quot;:&quot;video/MP2V&quot;,</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;         &quot;port&quot;:59160,</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;         &quot;elementary_stream_id&quot;:59160</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      }</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;   ]</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;}</div></div><!-- fragment --><p> This response should be parsed to obtain the elementary stream Id. It will be used to identify which decoder/processor to send each received frame (the stream identifier will be specified in the <a class="el" href="structproc__frame__ctx__s.html#a457dcb8ae6440506054f07483f48be1f">proc_frame_ctx_s::es_id</a> fied of the received frame).<br />
 In this example, we just have one video stream so all the frames received from the de-multiplexer will have the same stream Id.</p>
<h1>Running the application </h1>
<p>Just type in a shell:</p>
<blockquote class="doxtable">
<p>LD_LIBRARY_PATH=&lt;...&gt;/MediaProcessors_selfcontained/_install_dir_x86/lib &lt;...&gt;/MediaProcessors_selfcontained/_install_dir_x86/bin/mediaprocs_codecs_muxers_loopback </p>
</blockquote>
<p>Example: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;MediaProcessors_selfcontained$ LD_LIBRARY_PATH=./_install_dir_x86/lib ./_install_dir_x86/bin/mediaprocs_codecs_muxers_loopback </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;Created new TCP socket 4 for connection</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Starting server...</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;live555_rtsp.cpp 2290 Got a SDP description: v=0</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;o=- 1508643478136254 1 IN IP4 192.168.1.37</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;s=n/a</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;i=n/a</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;t=0 0</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;a=tool:LIVE555 Streaming Media v2017.07.18</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;a=type:broadcast</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;a=control:*</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;a=range:npt=0-</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;a=x-qt-text-nam:n/a</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;a=x-qt-text-inf:n/a</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;m=video 0 RTP/AVP 96</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;c=IN IP4 0.0.0.0</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;b=AS:3000</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;a=rtpmap:96 mp2v/90000</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;a=control:track1</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;live555_rtsp.cpp 2358 [URL: &#39;rtsp://127.0.0.1:8574/session/&#39;] Initiated the sub-session &#39;video/MP2V&#39; (client port[s] 59160, 59161)</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;live555_rtsp.cpp 2417 [URL: &#39;rtsp://127.0.0.1:8574/session/&#39;] Set up the sub-session &#39;video/MP2V&#39; (client port[s] 59160, 59161)</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;live555_rtsp.cpp 2459 [URL: &#39;rtsp://127.0.0.1:8574/session/&#39;] Started playing session...</div></div><!-- fragment --><p>A window should appear rendering a colorful animation:</p>
<div class="image">
<img src="../img4_examples_mediaprocs_codecs_muxers_loopback.png"  align="left" style="margin-right:90%;"/>
</div>
<p> <em align="left">Figure 4: Rendering window; mediaprocs_codecs_muxers_loopback example.</em></p>
<h3>Using the RESTful API</h3>
<p>In the following lines we attach some examples on how to perform RESTful requests in run-time.<br />
 For this purpose, we will use <a href="https://curl.haxx.se/">CURL</a> HTTP client commands from a shell.<br />
</p>
<p>We assume the 'mediaprocs_codecs_muxers_loopback' application is running.</p>
<p>To get the general representation of the running processors, type: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ curl -H &quot;Content-Type: application/json&quot; -X GET -d &#39;{}&#39; &quot;127.0.0.1:8088/procs.json&quot;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;{</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;   &quot;code&quot;:200,</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;   &quot;status&quot;:&quot;OK&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;   &quot;message&quot;:null,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;   &quot;data&quot;:{</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;      &quot;procs&quot;:[</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;         {</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;            &quot;proc_id&quot;:0,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;            &quot;proc_name&quot;:&quot;ffmpeg_m2v_enc&quot;,</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;            &quot;links&quot;:[</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;               {</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;                  &quot;rel&quot;:&quot;self&quot;,</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;                  &quot;href&quot;:&quot;/procs/0.json&quot;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;               }</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;            ]</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;         },</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;         {</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;            &quot;proc_id&quot;:1,</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;            &quot;proc_name&quot;:&quot;ffmpeg_m2v_dec&quot;,</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;            &quot;links&quot;:[</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;               {</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;                  &quot;rel&quot;:&quot;self&quot;,</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;                  &quot;href&quot;:&quot;/procs/1.json&quot;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;               }</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;            ]</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;         },</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;         {</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;            &quot;proc_id&quot;:2,</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;            &quot;proc_name&quot;:&quot;live555_rtsp_mux&quot;,</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;            &quot;links&quot;:[</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;               {</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;                  &quot;rel&quot;:&quot;self&quot;,</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;                  &quot;href&quot;:&quot;/procs/2.json&quot;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;               }</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;            ]</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;         },</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;         {</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;            &quot;proc_id&quot;:3,</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;            &quot;proc_name&quot;:&quot;live555_rtsp_dmux&quot;,</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;            &quot;links&quot;:[</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;               {</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                  &quot;rel&quot;:&quot;self&quot;,</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                  &quot;href&quot;:&quot;/procs/3.json&quot;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;               }</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;            ]</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;         }</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;      ]</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;   }</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;}</div></div><!-- fragment --><p>In the response above you will find the list of the instantiated processors specifying:</p><ul>
<li>the API identifier corresponding to each processor;</li>
<li>the processor name;</li>
<li>the link to the processor representational state.</li>
</ul>
<p>To get the representational state of any of the processors: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$curl -H &quot;Content-Type: application/json&quot; -X GET -d &#39;{}&#39; &quot;127.0.0.1:8088/procs/0.json&quot;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;{</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;   &quot;code&quot;:200,</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;   &quot;status&quot;:&quot;OK&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;   &quot;message&quot;:null,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;   &quot;data&quot;:{</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;      &quot;latency_avg_usec&quot;:35502,</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;      &quot;settings&quot;:{</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;         &quot;proc_name&quot;:&quot;ffmpeg_m2v_enc&quot;,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;         &quot;bit_rate_output&quot;:307200,</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;         &quot;frame_rate_output&quot;:15,</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;         &quot;width_output&quot;:352,</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;         &quot;height_output&quot;:288,</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;         &quot;gop_size&quot;:15,</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;         &quot;conf_preset&quot;:null</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;      }</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;   }</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;}</div></div><!-- fragment --> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$curl -H &quot;Content-Type: application/json&quot; -X GET -d &#39;{}&#39; &quot;127.0.0.1:8088/procs/1.json&quot;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;{</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;   &quot;code&quot;:200,</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;   &quot;status&quot;:&quot;OK&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;   &quot;message&quot;:null,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;   &quot;data&quot;:{</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;      &quot;latency_avg_usec&quot;:0,</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;      &quot;settings&quot;:{</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;         &quot;proc_name&quot;:&quot;ffmpeg_m2v_dec&quot;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      }</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;   }</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;}</div></div><!-- fragment --> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$curl -H &quot;Content-Type: application/json&quot; -X GET -d &#39;{}&#39; &quot;127.0.0.1:8088/procs/2.json&quot;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;{</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;   &quot;code&quot;:200,</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;   &quot;status&quot;:&quot;OK&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;   &quot;message&quot;:null,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;   &quot;data&quot;:{</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;      &quot;settings&quot;:{</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;         &quot;proc_name&quot;:&quot;live555_rtsp_mux&quot;,</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;         &quot;rtsp_port&quot;:8574,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;         &quot;time_stamp_freq&quot;:9000,</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;         &quot;rtsp_streaming_session_name&quot;:&quot;session&quot;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;      },</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;      &quot;elementary_streams&quot;:[</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;         {</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;            &quot;sdp_mimetype&quot;:&quot;video/mp2v&quot;,</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;            &quot;rtp_timestamp_freq&quot;:9000,</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;            &quot;elementary_stream_id&quot;:0</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;         }</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;      ]</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;   }</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;}</div></div><!-- fragment --> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$curl -H &quot;Content-Type: application/json&quot; -X GET -d &#39;{}&#39; &quot;127.0.0.1:8088/procs/3.json&quot;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;{</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;   &quot;code&quot;:200,</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;   &quot;status&quot;:&quot;OK&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;   &quot;message&quot;:null,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;   &quot;data&quot;:{</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;      &quot;settings&quot;:{</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;         &quot;proc_name&quot;:&quot;live555_rtsp_dmux&quot;,</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;         &quot;rtsp_url&quot;:&quot;rtsp://127.0.0.1:8574/session&quot;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      },</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;      &quot;elementary_streams&quot;:[</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;         {</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;            &quot;sdp_mimetype&quot;:&quot;video/MP2V&quot;,</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;            &quot;port&quot;:40014,</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;            &quot;elementary_stream_id&quot;:40014</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;         }</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;      ]</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;   }</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;}</div></div><!-- fragment --><p>If you want to change some of the video encoder parameters, let's say the ouput width and height, do: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$curl -X PUT &quot;127.0.0.1:8088/procs/0.json?width_output=720&amp;height_output=480&quot;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;$curl -H &quot;Content-Type: application/json&quot; -X GET -d &#39;{}&#39; &quot;127.0.0.1:8088/procs/0.json&quot;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;{</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;   &quot;code&quot;:200,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;   &quot;status&quot;:&quot;OK&quot;,</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;   &quot;message&quot;:null,</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;   &quot;data&quot;:{</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;      &quot;latency_avg_usec&quot;:40751,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      &quot;settings&quot;:{</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;         &quot;proc_name&quot;:&quot;ffmpeg_m2v_enc&quot;,</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;         &quot;bit_rate_output&quot;:307200,</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;         &quot;frame_rate_output&quot;:15,</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;         &quot;width_output&quot;:720,</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;         &quot;height_output&quot;:480,</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;         &quot;gop_size&quot;:15,</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;         &quot;conf_preset&quot;:null</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;      }</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;   }</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;}</div></div><!-- fragment --><p>You can even change the processor type on tun time. You have to be very careful of changing both, encoder and decoder sides.<br />
 In the following code we switch from MPEG2-video to H.264 video coding: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ curl -X PUT &quot;127.0.0.1:8088/procs/0.json?proc_name=ffmpeg_x264_enc&quot;; curl -X PUT &quot;127.0.0.1:8088/procs/1.json?proc_name=ffmpeg_x264_dec&quot;;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;$ curl -H &quot;Content-Type: application/json&quot; -X GET -d &#39;{}&#39; &quot;127.0.0.1:8088/procs/0.json&quot;; curl -H &quot;Content-Type: application/json&quot; -X GET -d &#39;{}&#39; &quot;127.0.0.1:8088/procs/1.json&quot;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;{</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;   &quot;code&quot;:200,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;   &quot;status&quot;:&quot;OK&quot;,</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;   &quot;message&quot;:null,</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;   &quot;data&quot;:{</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;      &quot;latency_avg_usec&quot;:941490,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      &quot;settings&quot;:{</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;         &quot;proc_name&quot;:&quot;ffmpeg_x264_enc&quot;,</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;         &quot;bit_rate_output&quot;:307200,</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;         &quot;frame_rate_output&quot;:15,</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;         &quot;width_output&quot;:352,</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;         &quot;height_output&quot;:288,</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;         &quot;gop_size&quot;:15,</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;         &quot;conf_preset&quot;:null,</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;         &quot;flag_zerolatency&quot;:false</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;      }</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;   }</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;}</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;{</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;   &quot;code&quot;:200,</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;   &quot;status&quot;:&quot;OK&quot;,</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;   &quot;message&quot;:null,</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;   &quot;data&quot;:{</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;      &quot;latency_avg_usec&quot;:0,</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;      &quot;settings&quot;:{</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;         &quot;proc_name&quot;:&quot;ffmpeg_x264_dec&quot;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;      }</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;   }</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;}</div></div><!-- fragment --><p>Changing RTSP multiplexer / de-multiplexer settings is also possible. We have to take into account:</p><ul>
<li>Any change on the server or client side will break the RTSP session;</li>
<li>Changes on any side, server or client, imply applying proper changes on the other side to successfully restore the RTSP session;</li>
<li>Any change on the server side reset the RTSP connection. As there is a connection time-out of 60 seconds, is very feasible that you would not be able to re-use the port. In consequence, if you have to change the server settings, make sure you are also changing the server port.</li>
</ul>
<p>Get the multiplexer and de-mutiplexer representational state:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ curl -H &quot;Content-Type: application/json&quot; -X GET -d &#39;{}&#39; &quot;127.0.0.1:8088/procs/2.json&quot; &amp;&amp; </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;curl -H &quot;Content-Type: application/json&quot; -X GET -d &#39;{}&#39; &quot;127.0.0.1:8088/procs/3.json&quot;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;{</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;   &quot;code&quot;:200,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;   &quot;status&quot;:&quot;OK&quot;,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;   &quot;message&quot;:null,</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;   &quot;data&quot;:{</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;      &quot;settings&quot;:{</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;         &quot;rtsp_port&quot;:8574,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;         &quot;time_stamp_freq&quot;:9000,</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;         &quot;rtsp_streaming_session_name&quot;:&quot;session&quot;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;      },</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;      &quot;elementary_streams&quot;:[</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;         {</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;            &quot;sdp_mimetype&quot;:&quot;video/mp2v&quot;,</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;            &quot;rtp_timestamp_freq&quot;:9000,</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;            &quot;elementary_stream_id&quot;:0</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;         }</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;      ]</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;   }</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;}</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;{</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;   &quot;code&quot;:200,</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;   &quot;status&quot;:&quot;OK&quot;,</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;   &quot;message&quot;:null,</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;   &quot;data&quot;:{</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;      &quot;settings&quot;:{</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;         &quot;rtsp_url&quot;:&quot;rtsp://127.0.0.1:8574/session&quot;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;      },</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;      &quot;elementary_streams&quot;:[</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;         {</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;            &quot;sdp_mimetype&quot;:&quot;video/MP2V&quot;,</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;            &quot;port&quot;:40924,</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;            &quot;elementary_stream_id&quot;:40924</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;         }</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;      ]</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;   }</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;}</div></div><!-- fragment --><p>We will change firstly the port and the session name on the client side:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ curl -X PUT &quot;127.0.0.1:8088/procs/3.json?rtsp_url=rtsp://127.0.0.1:8575/session2&quot;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;$ curl -H &quot;Content-Type: application/json&quot; -X GET -d &#39;{}&#39; &quot;127.0.0.1:8088/procs/3.json&quot;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;{</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;   &quot;code&quot;:200,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;   &quot;status&quot;:&quot;OK&quot;,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;   &quot;message&quot;:null,</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;   &quot;data&quot;:{</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;      &quot;settings&quot;:{</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;         &quot;rtsp_url&quot;:&quot;rtsp://127.0.0.1:8575/session2&quot;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      },</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;      &quot;elementary_streams&quot;:[</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;      ]</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;   }</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;}</div></div><!-- fragment --><p>As can be seen, the new client fail and closes the session. Now we will change the server accordingly, set again the client (to have the effect of restarting it), and check that a new session was successfully established:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$curl -X PUT &quot;127.0.0.1:8088/procs/2.json?rtsp_port=8575&amp;rtsp_streaming_session_name=session2&quot;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;$curl -X PUT &quot;127.0.0.1:8088/procs/3.json?rtsp_url=rtsp://127.0.0.1:8575/session2&quot;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;$ curl -H &quot;Content-Type: application/json&quot; -X GET -d &#39;{}&#39; &quot;127.0.0.1:8088/procs/3.json&quot;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;{</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;   &quot;code&quot;:200,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;   &quot;status&quot;:&quot;OK&quot;,</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;   &quot;message&quot;:null,</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;   &quot;data&quot;:{</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;      &quot;settings&quot;:{</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;         &quot;rtsp_url&quot;:&quot;rtsp://127.0.0.1:8575/session2&quot;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;      },</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;      &quot;elementary_streams&quot;:[</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;         {</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;            &quot;sdp_mimetype&quot;:&quot;video/MP2V&quot;,</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;            &quot;port&quot;:32916,</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;            &quot;elementary_stream_id&quot;:32916</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;         }</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;      ]</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;   }</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;}</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
